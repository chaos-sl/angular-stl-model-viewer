!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("three"),require("three/examples/jsm/loaders/STLLoader"),require("three/examples/jsm/controls/OrbitControls"),require("three/examples/jsm/lights/LightProbeGenerator.js")):"function"==typeof define&&define.amd?define("angular-stl-model-viewer",["exports","@angular/core","three","three/examples/jsm/loaders/STLLoader","three/examples/jsm/controls/OrbitControls","three/examples/jsm/lights/LightProbeGenerator.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["angular-stl-model-viewer"]={},e.ng.core,e.THREE,e.STLLoader,e.OrbitControls,e.LightProbeGenerator_js)}(this,(function(e,t,n,i,r,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function o(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{h(i.next(e))}catch(e){s(e)}}function a(e){try{h(i.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}h((i=i.apply(e,t||[])).next())}))}function a(e,t){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}Object.create;function h(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,s=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}var l,d;Object.create;(l=e.RotateDirection||(e.RotateDirection={}))[l.up=0]="up",l[l.right=1]="right",l[l.down=2]="down",l[l.left=3]="left",l[l.none=4]="none",(d=e.ZoomDirection||(e.ZoomDirection={}))[d.in=0]="in",d[d.out=1]="out";var u={castShadow:!0,position:new n.Vector3(0,0,0),receiveShadow:!0,scale:new n.Vector3(1,1,1)};var p=function(){function h(e,r,o){var a=this;this.cdr=e,this.eleRef=r,this.ngZone=o,this._models=[],this.hasControls=!0,this.camera=new n.PerspectiveCamera(15,window.innerWidth/window.innerHeight),this.cameraTarget=new n.Vector3(0,0,0),this.light=new n.DirectionalLight(16777215,1),this.material=new n.MeshPhongMaterial({color:12895428,shininess:100,specular:1118481}),this.scene=new n.Scene,this.renderer=new n.WebGLRenderer({antialias:!0}),this.controls=null,this.meshOptions=[],this.rendered=new t.EventEmitter,this.xzAngle=0,this.yzAngle=0,this.distance=10,this.zoomFactor=0,this.hasWebGL=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),this.meshGroup=new n.Object3D,this.isRendered=!1,this.showStlModel=!0,this.stlLoader=new i.STLLoader,this.lightProbe=new n.LightProbe(void 0,1),this.render=function(){a.renderer.render(a.scene,a.camera)},this.onWindowResize=function(){a.setSizes(),a.render()},this.cdr.detach(),this.light.position.set(10,10,10),this.camera.position.set(0,this.distance,0),this.camera.lookAt(0,0,0),this.scene.background=new n.Color(14474460),(new n.CubeTextureLoader).load(this.genCubeUrls("assets/",".png"),(function(e){e.encoding=n.sRGBEncoding,a.lightProbe.copy(s.LightProbeGenerator.fromCubeTexture(e)),a.texture=e,a.material=new n.MeshStandardMaterial({color:16777215,metalness:.4,roughness:.2,envMap:e,envMapIntensity:1})})),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0}return Object.defineProperty(h.prototype,"stlModels",{get:function(){return this._models},set:function(e){this._models=e,this.refreshMeshGroup()},enumerable:!1,configurable:!0}),h.prototype.genCubeUrls=function(e,t){return[e+"bg"+t,e+"bg"+t,e+"bg"+t,e+"bg"+t,e+"bg"+t,e+"bg"+t]},h.prototype.ngOnInit=function(){var e=this;this.hasWebGL?this.ngZone.runOutsideAngular((function(){e.init()})):console.error("stl-model-viewer: Seems like your system does not support webgl.")},h.prototype.ngOnDestroy=function(){var e=this;window.removeEventListener("resize",this.onWindowResize,!1),this.meshGroup.remove(),this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.dispose()),this.camera&&this.camera.remove(),this.light&&this.light.remove(),this.material&&this.material.dispose(),this.controls&&(this.controls.removeEventListener("change",this.render),this.controls.dispose()),this.scene&&(this.scene.children.forEach((function(t){e.scene.remove(t)})),this.scene.dispose())},h.prototype.zoom=function(t,i){if(void 0===i&&(i=1),this.camera instanceof n.PerspectiveCamera){switch(t){case e.ZoomDirection.in:this.distance+=i;break;case e.ZoomDirection.out:this.distance-=i}this.distance=this.distance<0?0:this.distance}this.rotate(e.RotateDirection.none)},h.prototype.rotate=function(t,n){void 0===n&&(n=1);var i=0;switch(t){case e.RotateDirection.up:i=.1;break;case e.RotateDirection.right:this.xzAngle+=.1;break;case e.RotateDirection.down:i=-.1;break;case e.RotateDirection.left:this.xzAngle-=.1}Math.abs(this.yzAngle+i*n)<Math.PI/2?this.yzAngle+=i:this.yzAngle=i>0?Math.PI/2:-Math.PI/2,this.camera.position.x=this.distance*Math.cos(this.yzAngle)*Math.cos(this.xzAngle),this.camera.position.z=this.distance*Math.cos(this.yzAngle)*Math.sin(this.xzAngle),this.camera.position.y=this.distance*Math.sin(this.yzAngle),this.camera.lookAt(0,0,0),this.render()},h.prototype.init=function(){return o(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){switch(t.label){case 0:return this.scene.add(this.lightProbe),this.camera.add(this.light),this.scene.add(this.camera),this.hasControls&&!this.controls&&(this.controls=new r.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableZoom=!0,this.controls.addEventListener("change",this.render)),window.addEventListener("resize",this.onWindowResize,!1),[4,this.refreshMeshGroup()];case 1:return t.sent(),this.scene.add(this.meshGroup),this.eleRef.nativeElement.appendChild(this.renderer.domElement),this.setSizes(),this.render(),this.ngZone.run((function(){e.isRendered=!0,e.rendered.emit(),e.cdr.detectChanges()})),[2]}}))}))},h.prototype.refreshMeshGroup=function(){return o(this,void 0,void 0,(function(){var t,n,i=this;return a(this,(function(r){switch(r.label){case 0:return(n=this.meshGroup).remove.apply(n,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}(this.meshGroup.children)),t=this.stlModels.filter((function(e){return e})).map((function(e,t){return i.createMesh(e,i.meshOptions[t])})),[4,Promise.all(t)];case 1:return r.sent().map((function(e){return i.meshGroup.add(e)})),this.rotate(e.RotateDirection.none),[2]}}))}))},h.prototype.createMesh=function(e,t){return void 0===t&&(t={}),o(this,void 0,void 0,(function(){var i,r,s,o,h,c,l,d,p;return a(this,(function(a){switch(a.label){case 0:return"string"!=typeof e?[3,2]:[4,this.stlLoader.loadAsync(e)];case 1:return r=a.sent(),[3,4];case 2:return[4,this.stlLoader.parse(e)];case 3:r=a.sent(),a.label=4;case 4:return(i=r).computeBoundingBox(),i.center(),s=i.boundingBox.max,o=s.x,h=s.y,c=s.z,this.distance=10*Math.max(o,h,c),(l=new n.Mesh(i,this.material)).rotateOnWorldAxis(new n.Vector3(0,1,0),-Math.PI/2),d=["position","scale","up"],p=Object.assign({},u,t),Object.getOwnPropertyNames(p).forEach((function(e){if(d.indexOf(e)>-1){var t=p[e];l[e].set(t.x,t.y,t.z)}else l[e]=p[e]})),[2,l]}}))}))},h.prototype.setSizes=function(){var e=this.eleRef.nativeElement.offsetWidth,t=this.eleRef.nativeElement.offsetHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)},h}();p.ɵfac=function(e){return new(e||p)(t.ɵɵdirectiveInject(t.ChangeDetectorRef),t.ɵɵdirectiveInject(t.ElementRef),t.ɵɵdirectiveInject(t.NgZone))},p.ɵcmp=t.ɵɵdefineComponent({type:p,selectors:[["stl-model-viewer"]],inputs:{stlModels:"stlModels",hasControls:"hasControls",camera:"camera",cameraTarget:"cameraTarget",light:"light",material:"material",scene:"scene",renderer:"renderer",controls:"controls",meshOptions:"meshOptions"},outputs:{rendered:"rendered"},decls:0,vars:0,template:function(e,t){},styles:["[_nghost-%COMP%] {\n        width: 100%\n        height: 100%\n        display: block\n      }"],changeDetection:0});var m=function(){};m.ɵmod=t.ɵɵdefineNgModule({type:m}),m.ɵinj=t.ɵɵdefineInjector({factory:function(e){return new(e||m)},imports:[[]]}),("undefined"==typeof ngJitMode||ngJitMode)&&t.ɵɵsetNgModuleScope(m,{declarations:[p],exports:[p]});var f=new n.AmbientLight(16777215,.3),g=new n.DirectionalLight(16777215,.2);g.position.set(-100,-100,100),g.lookAt(new n.Vector3(0,0,0));var v=new n.DirectionalLight(16777215,.2);v.position.set(100,0,0),v.lookAt(new n.Vector3(0,0,0));var w=new n.DirectionalLight(16777215,.2);w.position.set(-20,100,0),w.lookAt(new n.Vector3(0,0,0));var b=new n.DirectionalLight(16777215,.4);b.position.set(50,50,0),b.lookAt(new n.Vector3(-100,0,0));var y=function(){function e(e,t){this.file=e,this.ppmm=t,this.canvas=document.createElement("canvas"),this.stlLoader=new i.STLLoader,this.scene=new n.Scene,this.objects=new n.Group,this.lights=new n.Group,this.sideLength=0,this.distance=10}return e.prototype.read=function(){return o(this,void 0,void 0,(function(){var e,t=this;return a(this,(function(n){switch(n.label){case 0:return this.file instanceof File?(e=this,[4,new Promise((function(e,n){var i=new FileReader;i.onload=function(){return e(i.result)},i.readAsArrayBuffer(t.file)}))]):[3,2];case 1:e.file=n.sent(),n.label=2;case 2:return[2,this.file]}}))}))},e.prototype.snapshot=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return t=this.init,[4,this.read()];case 1:return t.apply(this,[n.sent()]),[4,this.shot(e)];case 2:return[2,n.sent()]}}))}))},e.prototype.init=function(e){this.geometry=this.stlLoader.parse(e),this.geometry.computeBoundingBox(),this.geometry.center(),this.geometry.computeBoundingSphere();var t=this.geometry.boundingBox.max,i=t.x,r=t.y,s=t.z;this.distance=10*Math.max(i,r,s);var o=this.geometry.boundingSphere,a=o.center,h=o.radius;console.debug(a,h,i,r,s),this.center=a,this.sideLength=2*h,this.canvas.height=this.canvas.width=this.sideLength*this.ppmm,this.renderer=new n.WebGLRenderer({alpha:!0,antialias:!0,canvas:this.canvas}),this.camera=new n.PerspectiveCamera(15,1),this.camera.position.set(0,this.distance,0),this.camera.lookAt(a),this.lights.add(f,g,v,w),this.camera.add(b);var c,l=new n.Mesh(this.geometry,(void 0===(c=16777215)&&(c=16777215),new n.MeshPhongMaterial({color:c,flatShading:!0,side:n.DoubleSide,wireframe:!1})));l.rotateOnWorldAxis(new n.Vector3(0,1,0),-Math.PI/2),this.objects.add(l),this.scene.add(this.camera,this.objects,this.lights),this.renderer.render(this.scene,this.camera)},e.prototype.shot=function(e){return o(this,void 0,void 0,(function(){var t,n,i,r,s,o,c,l,d;return a(this,(function(a){switch(a.label){case 0:t=[],n=[[0,this.distance,0],[0,-this.distance,0],[this.distance,0,0],[-this.distance,0,0],[0,0,this.distance],[0,0,-this.distance]],a.label=1;case 1:a.trys.push([1,6,7,8]),i=h(n),r=i.next(),a.label=2;case 2:return r.done?[3,5]:(s=r.value,this.camera.position.set(s[0],s[1],s[2]),this.camera.lookAt(this.center),this.camera.up.set(0,0,s.some((function(e){return e>0}))?-1:1),this.camera.updateProjectionMatrix(),this.renderer.render(this.scene,this.camera),[4,new Promise((function(e,t){return setTimeout(e)}))]);case 3:a.sent(),o=this.canvas.toDataURL("image/png"),t.push(o),e&&e(o.replace(/^data:image\/\w+;base64,/,"")),a.label=4;case 4:return r=i.next(),[3,2];case 5:return[3,8];case 6:return c=a.sent(),l={error:c},[3,8];case 7:try{r&&!r.done&&(d=i.return)&&d.call(i)}finally{if(l)throw l.error}return[7];case 8:return[2,{images:t,sideLength:this.sideLength,ppmm:this.ppmm}]}}))}))},e}();e.StlModelViewerComponent=p,e.StlModelViewerModule=m,e.StlSnapshotService=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-stl-model-viewer.umd.min.js.map