!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("three"),require("three/examples/jsm/loaders/STLLoader"),require("three/examples/jsm/controls/OrbitControls"),require("three/examples/jsm/lights/LightProbeGenerator.js")):"function"==typeof define&&define.amd?define("angular-stl-model-viewer",["exports","@angular/core","three","three/examples/jsm/loaders/STLLoader","three/examples/jsm/controls/OrbitControls","three/examples/jsm/lights/LightProbeGenerator.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["angular-stl-model-viewer"]={},e.ng.core,e.THREE,e.STLLoader,e.OrbitControls,e.LightProbeGenerator_js)}(this,(function(e,t,n,r,i,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function s(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{h(r.next(e))}catch(e){o(e)}}function a(e){try{h(r.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}h((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}Object.create;function h(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}var l,d;Object.create;(l=e.RotateDirection||(e.RotateDirection={}))[l.up=0]="up",l[l.right=1]="right",l[l.down=2]="down",l[l.left=3]="left",l[l.none=4]="none",(d=e.ZoomDirection||(e.ZoomDirection={}))[d.in=0]="in",d[d.out=1]="out";var u={castShadow:!0,position:new n.Vector3(0,0,0),receiveShadow:!0,scale:new n.Vector3(1,1,1)};var p=function(){function h(e,i,s){var a=this;this.cdr=e,this.eleRef=i,this.ngZone=s,this._models=[],this.hasControls=!0,this.camera=new n.PerspectiveCamera(15,window.innerWidth/window.innerHeight),this.cameraTarget=new n.Vector3(0,0,0),this.light=new n.DirectionalLight(16777215,1),this.material=new n.MeshPhongMaterial({color:12895428,shininess:100,specular:1118481}),this.scene=new n.Scene,this.renderer=new n.WebGLRenderer({antialias:!0}),this.controls=null,this.meshOptions=[],this.rendered=new t.EventEmitter,this.xzAngle=0,this.yzAngle=0,this.distance=10,this.zoomFactor=0,this.hasWebGL=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),this.meshGroup=new n.Object3D,this.isRendered=!1,this.showStlModel=!0,this.stlLoader=new r.STLLoader,this.lightProbe=new n.LightProbe(void 0,1),this.render=function(){a.renderer.render(a.scene,a.camera)},this.onWindowResize=function(){a.setSizes(),a.render()},this.cdr.detach(),this.light.position.set(10,10,10),this.camera.position.set(0,this.distance,0),this.camera.lookAt(0,0,0),this.scene.background=new n.Color(14474460),(new n.CubeTextureLoader).load(this.genCubeUrls("assets/",".png"),(function(e){e.encoding=n.sRGBEncoding,a.lightProbe.copy(o.LightProbeGenerator.fromCubeTexture(e)),a.texture=e,a.material=new n.MeshStandardMaterial({color:16777215,metalness:.4,roughness:.2,envMap:e,envMapIntensity:1})})),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0}return Object.defineProperty(h.prototype,"stlModels",{get:function(){return this._models},set:function(e){this._models=e,this.refreshMeshGroup()},enumerable:!1,configurable:!0}),h.prototype.genCubeUrls=function(e,t){return[e+"bg"+t,e+"bg"+t,e+"bg"+t,e+"bg"+t,e+"bg"+t,e+"bg"+t]},h.prototype.ngOnInit=function(){var e=this;this.hasWebGL?this.ngZone.runOutsideAngular((function(){e.init()})):console.error("stl-model-viewer: Seems like your system does not support webgl.")},h.prototype.ngOnDestroy=function(){var e=this;window.removeEventListener("resize",this.onWindowResize,!1),this.meshGroup.remove(),this.renderer&&(this.renderer.renderLists.dispose(),this.renderer.dispose()),this.camera&&this.camera.remove(),this.light&&this.light.remove(),this.material&&this.material.dispose(),this.controls&&(this.controls.removeEventListener("change",this.render),this.controls.dispose()),this.scene&&(this.scene.children.forEach((function(t){e.scene.remove(t)})),this.scene.dispose())},h.prototype.zoom=function(t,r){if(void 0===r&&(r=1),this.camera instanceof n.PerspectiveCamera){switch(t){case e.ZoomDirection.in:this.distance+=r;break;case e.ZoomDirection.out:this.distance-=r}this.distance=this.distance<0?0:this.distance}this.rotate(e.RotateDirection.none)},h.prototype.rotate=function(t,n){void 0===n&&(n=1);var r=0;switch(t){case e.RotateDirection.up:r=.1;break;case e.RotateDirection.right:this.xzAngle+=.1;break;case e.RotateDirection.down:r=-.1;break;case e.RotateDirection.left:this.xzAngle-=.1}Math.abs(this.yzAngle+r*n)<Math.PI/2?this.yzAngle+=r:this.yzAngle=r>0?Math.PI/2:-Math.PI/2,this.camera.position.x=this.distance*Math.cos(this.yzAngle)*Math.cos(this.xzAngle),this.camera.position.z=this.distance*Math.cos(this.yzAngle)*Math.sin(this.xzAngle),this.camera.position.y=this.distance*Math.sin(this.yzAngle),this.camera.lookAt(0,0,0),this.render()},h.prototype.init=function(){return s(this,void 0,void 0,(function(){var e=this;return a(this,(function(t){switch(t.label){case 0:return this.scene.add(this.lightProbe),this.camera.add(this.light),this.scene.add(this.camera),this.hasControls&&!this.controls&&(this.controls=new i.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableZoom=!0,this.controls.addEventListener("change",this.render)),window.addEventListener("resize",this.onWindowResize,!1),[4,this.refreshMeshGroup()];case 1:return t.sent(),this.scene.add(this.meshGroup),this.eleRef.nativeElement.appendChild(this.renderer.domElement),this.setSizes(),this.render(),this.ngZone.run((function(){e.isRendered=!0,e.rendered.emit(),e.cdr.detectChanges()})),[2]}}))}))},h.prototype.refreshMeshGroup=function(){return s(this,void 0,void 0,(function(){var t,n,r=this;return a(this,(function(i){switch(i.label){case 0:return(n=this.meshGroup).remove.apply(n,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}(this.meshGroup.children)),t=this.stlModels.map((function(e,t){return r.createMesh(e,r.meshOptions[t])})),[4,Promise.all(t)];case 1:return i.sent().map((function(e){return r.meshGroup.add(e)})),this.rotate(e.RotateDirection.none),[2]}}))}))},h.prototype.createMesh=function(e,t){return void 0===t&&(t={}),s(this,void 0,void 0,(function(){var r,i,o,s,h,c,l,d;return a(this,(function(a){switch(a.label){case 0:return[4,this.stlLoader.loadAsync(e)];case 1:return(r=a.sent()).computeBoundingBox(),r.center(),i=r.boundingBox.max,o=i.x,s=i.y,h=i.z,this.distance=10*Math.max(o,s,h),(c=new n.Mesh(r,this.material)).rotateOnWorldAxis(new n.Vector3(0,1,0),-Math.PI/2),l=["position","scale","up"],d=Object.assign({},u,t),Object.getOwnPropertyNames(d).forEach((function(e){if(l.indexOf(e)>-1){var t=d[e];c[e].set(t.x,t.y,t.z)}else c[e]=d[e]})),[2,c]}}))}))},h.prototype.setSizes=function(){var e=this.eleRef.nativeElement.offsetWidth,t=this.eleRef.nativeElement.offsetHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)},h}();p.decorators=[{type:t.Component,args:[{changeDetection:t.ChangeDetectionStrategy.OnPush,selector:"stl-model-viewer",template:"",styles:["\n      :host {\n        width: 100%\n        height: 100%\n        display: block\n      }\n    "]}]}],p.ctorParameters=function(){return[{type:t.ChangeDetectorRef},{type:t.ElementRef},{type:t.NgZone}]},p.propDecorators={stlModels:[{type:t.Input}],hasControls:[{type:t.Input}],camera:[{type:t.Input}],cameraTarget:[{type:t.Input}],light:[{type:t.Input}],material:[{type:t.Input}],scene:[{type:t.Input}],renderer:[{type:t.Input}],controls:[{type:t.Input}],meshOptions:[{type:t.Input}],rendered:[{type:t.Output}]};var m=function(){};m.decorators=[{type:t.NgModule,args:[{declarations:[p],exports:[p],imports:[]}]}];var f=function(e){return void 0===e&&(e=16777215),new n.MeshPhongMaterial({color:e,flatShading:!0,side:n.DoubleSide,wireframe:!1})},g=f,y=new n.AmbientLight(16777215,.3),w=new n.DirectionalLight(16777215,.2);w.position.set(-100,-100,100),w.lookAt(new n.Vector3(0,0,0));var v=new n.DirectionalLight(16777215,.2);v.position.set(100,0,0),v.lookAt(new n.Vector3(0,0,0));var b=new n.DirectionalLight(16777215,.2);b.position.set(-20,100,0),b.lookAt(new n.Vector3(0,0,0));var x=new n.DirectionalLight(16777215,.4);x.position.set(50,50,0),x.lookAt(new n.Vector3(-100,0,0));var L=function(){function e(e,t){this.file=e,this.ppmm=t,this.canvas=document.createElement("canvas"),this.renderer=new n.WebGLRenderer({alpha:!0,antialias:!0,canvas:this.canvas}),this.stlLoader=new r.STLLoader,this.scene=new n.Scene,this.objects=new n.Group,this.lights=new n.Group,this.sideLength=0}return e.prototype.snapshot=function(e){var t=this;return new Promise((function(e,n){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsArrayBuffer(t.file)})).then((function(n){return t.init(n),t.shot(e)}))},e.prototype.init=function(e){this.geometry=this.stlLoader.parse(e),this.geometry.computeBoundingBox(),this.geometry.center(),this.geometry.computeBoundingSphere();var t=this.geometry.boundingBox,r=t.max,i=t.min;this.sideLength=Math.ceil(Math.max(r.x-i.x,r.y-i.y,r.z-i.z)),this.canvas.height=this.canvas.width=this.sideLength,this.camera=new n.OrthographicCamera(-this.sideLength/2,this.sideLength/2,this.sideLength/2,-this.sideLength/2,1,1e3),this.camera.position.set(0,0,100),this.camera.lookAt(new n.Vector3(0,0,0)),this.lights.add(y,w,v,b),this.camera.add(x),this.objects.add(new n.Mesh(this.geometry,f(16777215))),this.scene.add(this.camera,this.objects,this.lights)},e.prototype.shot=function(e){var t,r,i=[];try{for(var o=h([[0,0,100,-1,0,0],[0,0,-100,1,0,0],[0,100,50,0,0,-1],[100,0,50,0,0,-1],[0,100,-50,0,0,1],[100,0,-50,0,0,1]]),s=o.next();!s.done;s=o.next()){var a=s.value;this.camera.position.set(a[0],a[1],a[2]),this.camera.up.set(a[3],a[4],a[5]),this.camera.lookAt(new n.Vector3(0,0,0)),this.camera.updateProjectionMatrix(),this.renderer.render(this.scene,this.camera);var c=this.canvas.toDataURL("image/png");i.push(c),e&&e(c.replace(/^data:image\/\w+;base64,/,""))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return{images:i,sideLength:this.sideLength,ppmm:this.ppmm}},e}();e.StlModelViewerComponent=p,e.StlModelViewerModule=m,e.StlSnapshotService=L,e.ɵ0=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-stl-model-viewer.umd.min.js.map